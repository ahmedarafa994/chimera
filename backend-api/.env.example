# =============================================================================
# Project Chimera Backend Environment Variables
# =============================================================================
# Copy this file to .env and fill in the values for your environment.
# Never commit .env to version control.
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Server host (optional)
# Default: 0.0.0.0
HOST=0.0.0.0

# Server port (optional)
# Default: 8000
PORT=8000

# Environment mode (optional)
# Options: development, staging, production
# Default: development
ENVIRONMENT=development

# Debug mode (optional)
# Default: false in production
DEBUG=true

# Log level (optional)
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------

# Admin API key for protected endpoints (required)
# Used for admin dashboard authentication
CHIMERA_API_KEY=your-secure-api-key-here

# Secret key for JWT/session signing (required)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=your-secret-key-here

# CORS allowed origins (optional)
# Comma-separated list of allowed origins
# Default: http://localhost:3000
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# Rate limiting (optional)
# Requests per minute per IP
# Default: 60
RATE_LIMIT_PER_MINUTE=60

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------

# Database URL (required for persistence)
# SQLite: sqlite:///./chimera.db
# PostgreSQL: postgresql://user:password@localhost:5432/chimera
# MySQL: mysql://user:password@localhost:3306/chimera
DATABASE_URL=sqlite:///./chimera.db

# Database pool size (optional)
# Default: 5
DATABASE_POOL_SIZE=5

# Database max overflow (optional)
# Default: 10
DATABASE_MAX_OVERFLOW=10

# -----------------------------------------------------------------------------
# Redis Configuration (for Celery and caching)
# -----------------------------------------------------------------------------

# Redis URL (required for async tasks and caching)
# Default: redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0

# Redis password (optional)
# REDIS_PASSWORD=

# Cache TTL in seconds (optional)
# Default: 3600 (1 hour)
CACHE_TTL=3600

# -----------------------------------------------------------------------------
# Celery Configuration (for async tasks)
# -----------------------------------------------------------------------------

# Celery broker URL (required for async tasks)
# Default: redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0

# Celery result backend (optional)
# Default: redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Celery task time limit in seconds (optional)
# Default: 3600 (1 hour)
CELERY_TASK_TIME_LIMIT=3600

# -----------------------------------------------------------------------------
# LLM Provider Configuration
# -----------------------------------------------------------------------------

# OpenAI Configuration
OPENAI_API_KEY=your-openai-api-key
OPENAI_ORG_ID=your-org-id
OPENAI_MODEL=gpt-4o

# Anthropic Configuration
ANTHROPIC_API_KEY=your-anthropic-api-key
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# Google AI Configuration
GOOGLE_API_KEY=your-google-api-key
GOOGLE_MODEL=gemini-3-pro-preview

# DeepSeek Configuration
# IMPORTANT: Only 'deepseek-chat' and 'deepseek-reasoner' are valid models
# 'deepseek-coder' is NOT available and will cause "Model Not Exist" errors
DEEPSEEK_API_KEY=your-deepseek-api-key
DEEPSEEK_MODEL=deepseek-chat

# Azure OpenAI Configuration
AZURE_OPENAI_API_KEY=your-azure-api-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_OPENAI_DEPLOYMENT_NAME=your-deployment-name

# Ollama Configuration (local models)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_DEFAULT_MODEL=llama2

# HuggingFace Configuration
HUGGINGFACE_API_KEY=your-huggingface-api-key
HUGGINGFACE_DEFAULT_MODEL=meta-llama/Llama-2-7b-chat-hf

# -----------------------------------------------------------------------------
# Provider Management
# -----------------------------------------------------------------------------

# Default provider (optional)
# Options: deepseek, google, openai, anthropic, azure, ollama, huggingface
# Default: deepseek
DEFAULT_PROVIDER=deepseek

# AI Provider Selection (deepseek or gemini)
AI_PROVIDER=deepseek

# Enable provider fallback (optional)
# Default: true
ENABLE_PROVIDER_FALLBACK=true

# Provider fallback order (optional)
# Comma-separated list of provider IDs
PROVIDER_FALLBACK_ORDER=deepseek,google,openai,anthropic

# Provider health check interval in seconds (optional)
# Default: 60
PROVIDER_HEALTH_CHECK_INTERVAL=60

# -----------------------------------------------------------------------------
# API Connection Mode Configuration (Story 1.1)
# -----------------------------------------------------------------------------

# API Connection Mode - direct or proxy via AIClient-2-API Server
# Options: direct, proxy
# Default: direct
API_CONNECTION_MODE=direct

# -----------------------------------------------------------------------------
# Proxy Mode Configuration (AIClient-2-API Server)
# -----------------------------------------------------------------------------

# Proxy server endpoint (used when API_CONNECTION_MODE=proxy)
# Default: http://localhost:8080
PROXY_MODE_ENDPOINT=http://localhost:8080

# Enable proxy mode
# Default: false
PROXY_MODE_ENABLED=false

# Enable health check for proxy endpoint
# Default: true
PROXY_MODE_HEALTH_CHECK=true

# Timeout for proxy requests in seconds (5-120)
# Default: 30
PROXY_MODE_TIMEOUT=30

# Fallback to direct mode if proxy is unavailable
# Default: true
PROXY_MODE_FALLBACK_TO_DIRECT=true

# Health check interval for proxy endpoint in seconds (10-300)
# Default: 30
PROXY_MODE_HEALTH_CHECK_INTERVAL=30

# -----------------------------------------------------------------------------
# Direct Mode Base URLs (override defaults if needed)
# -----------------------------------------------------------------------------

# OpenAI direct endpoint
# Default: https://api.openai.com/v1
# DIRECT_OPENAI_BASE_URL=https://api.openai.com/v1

# Anthropic direct endpoint
# Default: https://api.anthropic.com/v1
# DIRECT_ANTHROPIC_BASE_URL=https://api.anthropic.com/v1

# Google/Gemini direct endpoint
# Default: https://generativelanguage.googleapis.com/v1beta
# DIRECT_GOOGLE_BASE_URL=https://generativelanguage.googleapis.com/v1beta

# DeepSeek direct endpoint (must include /v1 for OpenAI SDK compatibility)
# Default: https://api.deepseek.com/v1
# DIRECT_DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

# Qwen direct endpoint
# Default: https://dashscope.aliyuncs.com/api/v1
# DIRECT_QWEN_BASE_URL=https://dashscope.aliyuncs.com/api/v1

# -----------------------------------------------------------------------------
# API Key Encryption Configuration (Story 1.1)
# -----------------------------------------------------------------------------

# Enable encryption for API keys at rest
# Default: true
ENCRYPT_API_KEYS_AT_REST=true

# Encryption key for API keys (base64-encoded 32-byte key)
# Generate with: python -c "import secrets, base64; print(base64.urlsafe_b64encode(secrets.token_bytes(32)).decode())"
# If not provided, a key will be derived from CHIMERA_ENCRYPTION_PASSWORD
# CHIMERA_ENCRYPTION_KEY=

# Encryption password (used if CHIMERA_ENCRYPTION_KEY not provided)
# Default: chimera-default-key-2025 (CHANGE IN PRODUCTION!)
# CHIMERA_ENCRYPTION_PASSWORD=your-secure-password-here

# -----------------------------------------------------------------------------
# Configuration Hot-Reload (Story 1.1)
# -----------------------------------------------------------------------------

# Enable configuration hot-reload without restart
# Default: true
ENABLE_CONFIG_HOT_RELOAD=true

# -----------------------------------------------------------------------------
# Rate Limiting Configuration
# -----------------------------------------------------------------------------

# Enable rate limiting (optional)
# Default: true
ENABLE_RATE_LIMITING=true

# Rate limit window in seconds (optional)
# Default: 60
RATE_LIMIT_WINDOW=60

# Rate limit per model (optional)
# Format: model_id:limit,model_id:limit
# Example: gpt-4:10,gpt-3.5-turbo:30
MODEL_RATE_LIMITS=gpt-4:10,gpt-3.5-turbo:30,claude-3-opus:10

# -----------------------------------------------------------------------------
# AutoDAN Configuration
# -----------------------------------------------------------------------------

# AutoDAN max iterations (optional)
# Default: 100
AUTODAN_MAX_ITERATIONS=100

# AutoDAN timeout in seconds (optional)
# Default: 600 (10 minutes)
AUTODAN_TIMEOUT=600

# AutoDAN batch size (optional)
# Default: 16
AUTODAN_BATCH_SIZE=16

# -----------------------------------------------------------------------------
# Evasion Task Configuration
# -----------------------------------------------------------------------------

# Evasion task timeout in seconds (optional)
# Default: 1800 (30 minutes)
EVASION_TASK_TIMEOUT=1800

# Evasion max concurrent tasks (optional)
# Default: 5
EVASION_MAX_CONCURRENT_TASKS=5

# Evasion result retention days (optional)
# Default: 30
EVASION_RESULT_RETENTION_DAYS=30

# -----------------------------------------------------------------------------
# Lifelong Learning Configuration
# -----------------------------------------------------------------------------

# Enable lifelong learning (optional)
# Default: false
ENABLE_LIFELONG_LEARNING=false

# Lifelong learning model path (optional)
# LIFELONG_MODEL_PATH=./models/lifelong

# Lifelong learning update interval in hours (optional)
# Default: 24
LIFELONG_UPDATE_INTERVAL=24

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------

# Enable AutoDAN feature (optional)
# Default: true
FEATURE_AUTODAN=true

# Enable AutoAdv feature (optional)
# Default: true
FEATURE_AUTOADV=true

# Enable Evasion Tasks feature (optional)
# Default: true
FEATURE_EVASION=true

# Enable Chat feature (optional)
# Default: true
FEATURE_CHAT=true

# Enable Admin endpoints (optional)
# Default: true
FEATURE_ADMIN=true

# Enable Provider Management (optional)
# Default: true
FEATURE_PROVIDER_MANAGEMENT=true

# Enable Lifelong Learning (optional)
# Default: false
FEATURE_LIFELONG_LEARNING=false

# -----------------------------------------------------------------------------
# Monitoring & Logging
# -----------------------------------------------------------------------------

# Enable request logging (optional)
# Default: true
ENABLE_REQUEST_LOGGING=true

# Enable metrics collection (optional)
# Default: false
ENABLE_METRICS=false

# Metrics endpoint (optional)
# METRICS_ENDPOINT=

# Enable tracing (optional)
# Default: false
ENABLE_TRACING=false

# Tracing endpoint (optional)
# TRACING_ENDPOINT=

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=

# -----------------------------------------------------------------------------
# Storage Configuration
# -----------------------------------------------------------------------------

# File storage path (optional)
# Default: ./storage
STORAGE_PATH=./storage

# Max upload size in bytes (optional)
# Default: 10485760 (10MB)
MAX_UPLOAD_SIZE=10485760

# Enable S3 storage (optional)
# Default: false
ENABLE_S3_STORAGE=false

# S3 Configuration (if enabled)
# S3_BUCKET_NAME=
# S3_ACCESS_KEY=
# S3_SECRET_KEY=
# S3_REGION=
# S3_ENDPOINT_URL=

# -----------------------------------------------------------------------------
# Email/SMTP Configuration (Multi-User Authentication)
# -----------------------------------------------------------------------------

# SMTP server hostname (required for email delivery)
# Default: localhost
SMTP_HOST=localhost

# SMTP server port (required)
# Common ports: 25 (plain), 587 (STARTTLS), 465 (SSL/TLS)
# Default: 587
SMTP_PORT=587

# SMTP authentication username (optional)
# Leave empty for servers that don't require auth
# SMTP_USERNAME=

# SMTP authentication password (optional)
# SMTP_PASSWORD=

# SMTP security mode (optional)
# Options: none, starttls, ssl_tls
# Default: starttls
SMTP_SECURITY=starttls

# Default sender email address (required)
# Default: noreply@chimera.local
SMTP_FROM_EMAIL=noreply@chimera.local

# Default sender display name (optional)
# Default: Chimera
SMTP_FROM_NAME=Chimera

# SMTP connection timeout in seconds (optional)
# Default: 30
SMTP_TIMEOUT=30

# Development mode for emails (optional)
# When true, emails are logged instead of sent
# Default: true in development, false in production
EMAIL_DEV_MODE=true

# Email verification URL (frontend endpoint)
# Default: http://localhost:3000/verify-email
EMAIL_VERIFICATION_URL=http://localhost:3000/verify-email

# Password reset URL (frontend endpoint)
# Default: http://localhost:3000/reset-password
EMAIL_PASSWORD_RESET_URL=http://localhost:3000/reset-password

# Frontend application URL (used in email templates)
# Default: http://localhost:3000
EMAIL_FRONTEND_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# JWT Authentication Configuration
# -----------------------------------------------------------------------------

# JWT secret key for token signing (required)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
JWT_SECRET=your-jwt-secret-key-here

# JWT access token expiry in minutes (optional)
# Default: 30
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# JWT refresh token expiry in days (optional)
# Default: 7
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
